

<!DOCTYPE html>
<html class="writer-html5" lang="ja" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ファクトリーのスクリプティングガイド &mdash; gris3 1.0.0 ドキュメント</title>
  

  
  <link rel="stylesheet" href="../_static/css/customTheme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="author" title="このドキュメントについて" href="../about.html" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="命名規則" href="namingRule.html" />
    <link rel="prev" title="ScriptBasedRigging-概要" href="scriptBasedRigging.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> gris3
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">スタートアップ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">インストールと起動</a></li>
<li class="toctree-l1"><a class="reference internal" href="updateLog.html">更新履歴</a></li>
</ul>
<p class="caption"><span class="caption-text">マニュアル</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="scriptBasedRigging.html">ScriptBasedRigging-概要</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">ファクトリーのスクリプティングガイド</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#factory">Factoryを起動する</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#directorypath">directoryPath</a></li>
<li class="toctree-l3"><a class="reference internal" href="#assetnameassettypeproject">assetName、assetType、project</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#node">nodeモジュール</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">nodeモジュールを試してみる</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#sff-accessattributes">アトリビュートの値にアクセスする</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">アトリビュートをオブジェクト化する</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">階層を持つアトリビュートを操作する</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sff-makeconnection">コネクションを作成する</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sff-disconnectattr">コネクションをを解除する</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#sff-createnode">ノードを作成しオブジェクト化する</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sff-convselectedtoobj">選択ノードをオブジェクト化する</a></li>
<li class="toctree-l3"><a class="reference internal" href="#asobjecttoobjects">asObject、toObjectsを使用する</a></li>
<li class="toctree-l3"><a class="reference internal" href="#maya">mayaの既存コマンドのラッパーから変換する</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">オブジェクト化したノードの扱い</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#constructor">Constructorクラス</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id13">コントローラを作る</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tocontroller">toController</a></li>
<li class="toctree-l4"><a class="reference internal" href="#connectcontroller">connectController</a></li>
<li class="toctree-l4"><a class="reference internal" href="#parentascontroller">parentAsController</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sff-optionsaboutcreationctrl">作成オプションについて</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id23">各種ルートを作成する</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id24">ルートの種類</a></li>
<li class="toctree-l4"><a class="reference internal" href="#parentjointisfollow">引数parentJointとisFollow</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id25">デフォルト値一覧</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id26">重要ノードを取得する</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#func">funcモジュール</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id27">階層構造に関する関数</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#listnodechain">listNodeChain</a></li>
<li class="toctree-l4"><a class="reference internal" href="#listlength">listLength</a></li>
<li class="toctree-l4"><a class="reference internal" href="#listlengthratio">listLengthRatio</a></li>
<li class="toctree-l4"><a class="reference internal" href="#listsinglechain">listSingleChain</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id28">アトリビュートの状態を操作する関数</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#locktransform">lockTransform</a></li>
<li class="toctree-l4"><a class="reference internal" href="#unlocktransform">unlockTransform</a></li>
<li class="toctree-l4"><a class="reference internal" href="#controlchannels">controlChannels</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id29">アトリビュートのコネクションを操作する関数</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#fconnectattr">fConnectAttr</a></li>
<li class="toctree-l4"><a class="reference internal" href="#transferconnection">transferConnection</a></li>
<li class="toctree-l4"><a class="reference internal" href="#replaceconnections">replaceConnections</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setattrfromconnected">setAttrFromConnected</a></li>
<li class="toctree-l4"><a class="reference internal" href="#connectkeyableattr">connectKeyableAttr</a></li>
<li class="toctree-l4"><a class="reference internal" href="#connectmultattr">connectMultAttr</a></li>
<li class="toctree-l4"><a class="reference internal" href="#makedecomposematrixconnection">makeDecomposeMatrixConnection</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#transform">Transformの位置をブレンドする</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#blendselfconnection">blendSelfConnection</a></li>
<li class="toctree-l4"><a class="reference internal" href="#blendtransform">blendTransform</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id30">Transformを拘束する</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#surfacefitter">SurfaceFitter</a></li>
<li class="toctree-l4"><a class="reference internal" href="#localconstraint">localConstraint</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fixconstraint">fixConstraint</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id31">デフォーマーを追加する</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#wrap">wrap</a></li>
<li class="toctree-l4"><a class="reference internal" href="#localwrap">localWrap</a></li>
<li class="toctree-l4"><a class="reference internal" href="#createsculptdeformer">createSculptDeformer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#softmodification">SoftModification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id35">長さや角度を検知する</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#createdistancedrivernode">createDistanceDriverNode</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id36">createSculptDeformer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id37">ジョイントチェーンのツイスト、ベンド制御を行う</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#createnontwistedbender">createNonTwistedBender</a></li>
<li class="toctree-l4"><a class="reference internal" href="#createbendcontrol">createBendControl</a></li>
<li class="toctree-l4"><a class="reference internal" href="#createbendtwistcontrol">createBendTwistControl</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id38">バインドジョイントに関する関数</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#createbindjoint">createBindJoint</a></li>
<li class="toctree-l4"><a class="reference internal" href="#findbindjoint">findBindJoint</a></li>
<li class="toctree-l4"><a class="reference internal" href="#connecttobindjoint">connectToBindJoint</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="namingRule.html">命名規則</a></li>
<li class="toctree-l1"><a class="reference internal" href="rigUnits.html">Rig Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="includedExtraConstructors.html">組み込み済みExtraConstructor</a></li>
</ul>
<p class="caption"><span class="caption-text">ガジェット</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../gadgets/jointEditor.html">Joint Editor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gadgets/modelSetup.html">Model Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gadgets/renamer.html">Renamer</a></li>
</ul>
<p class="caption"><span class="caption-text">スクリプトツール</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/jointEditor.html">jointEditor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/extraJoint.html">extraJoint</a></li>
</ul>
<p class="caption"><span class="caption-text">開発者向けドキュメント</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev/factorySettings.html">ファクトリーセッティング</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/factoryModules.html">ファクトリーモジュール</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/makingRigUnits.html">リグユニットの開発</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/constructor.html">コンストラクタ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/extraConstructor.html">エクストラコンストラクタ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/namingRuleSystem.html">命名規則管理システム</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/operateByScript.html">スクリプトによって操作する</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/settings.html">設定にまつわる機能</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">gris3</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>ファクトリーのスクリプティングガイド</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/contents/scriptingForFactory.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>ファクトリーのスクリプティングガイド<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>この章ではスクリプトによるファクトリーのセットアップを行う際に、
知っておくと便利な機能やコマンドの説明を行います。</p>
<div class="section" id="factory">
<h2>Factoryを起動する<a class="headerlink" href="#factory" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>ファクトリーのGUIを起動するには以下のコマンドを実行します。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gris3</span>
<span class="n">gris3</span><span class="o">.</span><span class="n">showFactory</span><span class="p">()</span>
</pre></div>
</div>
<p>showFactory関数には引き数を渡すことが出来ます。</p>
<table class="docutils align-default" id="id39">
<caption><span class="caption-text">showFactoryの引き数</span><a class="headerlink" href="#id39" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>引き数</strong></p></td>
<td><p><strong>型</strong></p></td>
<td><p><strong>説明</strong></p></td>
</tr>
<tr class="row-even"><td><p>directoryPath</p></td>
<td><p>str</p></td>
<td><p>プロジェクトディレクトリのパス</p></td>
</tr>
<tr class="row-odd"><td><p>assetName</p></td>
<td><p>str</p></td>
<td><p>アセット名</p></td>
</tr>
<tr class="row-even"><td><p>assetType</p></td>
<td><p>str</p></td>
<td><p>アセットタイプ</p></td>
</tr>
<tr class="row-odd"><td><p>project</p></td>
<td><p>str</p></td>
<td><p>プロジェクト名</p></td>
</tr>
<tr class="row-even"><td><p>isDockable</p></td>
<td><p>bool</p></td>
<td><p>ドッキング可能かどうか</p></td>
</tr>
<tr class="row-odd"><td><p>forceUpdate</p></td>
<td><p>bool</p></td>
<td><p>強制的にGUIの更新をかけるかどうか</p></td>
</tr>
</tbody>
</table>
<div class="section" id="directorypath">
<h3>directoryPath<a class="headerlink" href="#directorypath" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>この引き数を指定すると、
指定されたパスをプロジェクトとして設定した状態でFactoryを起動します。</p>
</div>
<div class="section" id="assetnameassettypeproject">
<h3>assetName、assetType、project<a class="headerlink" href="#assetnameassettypeproject" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>この引き数はそれぞれアセット名、アセットの種類、
プロジェクト名を指定した状態でFactoryを起動します。
これら設定は引き数
<strong>directoryPath</strong>
が示すパスがプロジェクトディレクトリとして設定されていない場合のみ有効で、
Factory起動後のStartup画面で自動的にこれら情報が入力された状態で開始されます。</p>
</div>
</div>
<div class="section" id="node">
<h2>nodeモジュール<a class="headerlink" href="#node" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>nodeモジュールはMayaのノードを操作する上で、
cmdsよりも利便性を強化した機能を提供します。
nodeモジュールによる操作はPymel的な、
いわゆるオブジェクト指向的な操作を提供します。</p>
<div class="section" id="id2">
<h3>nodeモジュールを試してみる<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>試しにnodeモジュールを試してみましょう。
まずはnodeモジュールをimportします。</p>
<p>機能を使用するには何種類かのアプローチ方法が存在しますので、
必用な時に確認してみて下さい。</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="#sff-createnode"><span class="std std-ref">ノードを作成しオブジェクト化する</span></a></p></li>
<li><p><a class="reference internal" href="#sff-convselectedtoobj"><span class="std std-ref">選択ノードをオブジェクト化する</span></a></p></li>
<li><p><a class="reference internal" href="#sff-useasobjectandtoobjects"><span class="std std-ref">asObject、toObjectsを使用する</span></a></p></li>
<li><p><a class="reference internal" href="#sff-convwrappercommand"><span class="std std-ref">mayaの既存コマンドのラッパーから変換する</span></a></p></li>
</ul>
</div></blockquote>
<div class="section" id="sff-accessattributes">
<span id="id3"></span><h4>アトリビュートの値にアクセスする<a class="headerlink" href="#sff-accessattributes" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>まずはノードを作成しオブジェクト化を行い、
アトリビュートの値にアクセスしてみましょう。</p>
<p>アトリビュートにアクセスするには、作成したオブジェクトに対し</p>
<p><strong>オブジェクト('アトリビュート名')</strong></p>
<p>で値を取得、</p>
<p><strong>オブジェクト('アトリビュート名', 値)</strong></p>
<p>で値を設定します。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gris3</span> <span class="kn">import</span> <span class="n">node</span>
<span class="n">trs</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="s1">&#39;nullA&#39;</span><span class="p">)</span>

<span class="c1"># アトリビュートの変更。</span>
<span class="n">trs</span><span class="p">(</span><span class="s1">&#39;translateX&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="c1"># アトリビュートの値を取得する。</span>
<span class="n">trs_values</span> <span class="o">=</span> <span class="n">trs</span><span class="p">(</span><span class="s1">&#39;translate&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># アトリビュートを再度変更。</span>
<span class="n">trs</span><span class="p">(</span><span class="s1">&#39;translateY&#39;</span><span class="p">,</span> <span class="n">trs_values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</td></tr></table></div>
<p>また、値の取得、値の設定はそれぞれ
<strong>cmds.getAttr</strong>
や
<strong>cmds.setAttr</strong>
の引数を使用する事もできます。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gris3</span> <span class="kn">import</span> <span class="n">node</span>
<span class="n">trs</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="s1">&#39;nullA&#39;</span><span class="p">)</span>

<span class="c1"># アトリビュートのロック状態の参照。</span>
<span class="n">trs</span><span class="p">(</span><span class="s1">&#39;translateX&#39;</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Result: False #</span>
</pre></div>
</td></tr></table></div>
<p>またmatrixなどをsetAttrする場合はtypeオプションで'matrix'を指定する必用があります。
オブジェクト化したノードにmatrixを設定する場合、同様の処理をする必用があります。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gris3</span> <span class="kn">import</span> <span class="n">node</span>
<span class="n">decmtx</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s1">&#39;decomposeMatrix&#39;</span><span class="p">)</span>
<span class="n">matrixlist</span> <span class="o">=</span> <span class="p">[</span>
    <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># matrix型はtypeオプションの指定が必用。</span>
<span class="n">decmtx</span><span class="p">(</span><span class="s1">&#39;inputMatrix&#39;</span><span class="p">,</span> <span class="n">matrixlist</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;matrix&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id4">
<h4>アトリビュートをオブジェクト化する<a class="headerlink" href="#id4" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>ノードをオブジェクト化するように、アトリビュートもオブジェクト化できます。
アトリビュートをオブジェクト化するには、
ノードオブジェクトのattrメソッドを使用します。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gris3</span> <span class="kn">import</span> <span class="n">node</span>
<span class="n">trs</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="s1">&#39;nullA&#39;</span><span class="p">)</span>

<span class="c1"># アトリビュートのロック状態の参照。</span>
<span class="n">attr</span> <span class="o">=</span> <span class="n">trs</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;tx&#39;</span><span class="p">)</span>
<span class="n">attr</span><span class="o">.</span><span class="n">attrName</span><span class="p">()</span> <span class="c1"># アトリビュート名を取得</span>
<span class="c1"># Result: translateX #</span>

<span class="n">attr</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>    <span class="c1"># 値を設定</span>
<span class="n">attr</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>      <span class="c1"># 値を取得</span>
<span class="c1"># Result: 10.0 #</span>
</pre></div>
</td></tr></table></div>
<p>この機能は、通常設定・取得する場合にはあまり有効ではなく、前述の
<a class="reference internal" href="#sff-accessattributes"><span class="std std-ref">アトリビュートの値にアクセスする</span></a>
の方が簡単です。
しかし後述する
<a class="reference internal" href="#sff-makeconnection"><span class="std std-ref">コネクションを作成する</span></a>
や
<a class="reference internal" href="#sff-disconnectattr"><span class="std std-ref">コネクションをを解除する</span></a>
では便利な機能が備わっています。</p>
</div>
<div class="section" id="id5">
<h4>階層を持つアトリビュートを操作する<a class="headerlink" href="#id5" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>またtranslateやrotateのような子階層を持つアトリビュートにまとめてアクセスるには、
アトリビュートオブジェクトの頭に
<strong>「~」</strong>
をつけます。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gris3</span> <span class="kn">import</span> <span class="n">node</span>
<span class="n">trs</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="s1">&#39;nullA&#39;</span><span class="p">)</span>

<span class="c1"># translateX, translateY、translateZをまとめて取り扱うオブジェクト</span>
<span class="n">translate</span> <span class="o">=</span> <span class="o">~</span><span class="n">trs</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
<span class="c1"># ３つの値をまとめて設定。</span>
<span class="n">translate</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># ３つの値をまとめて取得。</span>
<span class="n">translate</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="c1"># Result: [2.0, 4.0, 1.0] #</span>

<span class="c1"># for文を使用して個別のアトリビュートにアクセスする。</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">translate</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> : </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">attrName</span><span class="p">(),</span> <span class="n">t</span><span class="o">.</span><span class="n">get</span><span class="p">()))</span>
</pre></div>
</td></tr></table></div>
<p><strong>「~」</strong>
を使用して取得する、子アトリビュートをまとめて取り扱うこのオブジェクトは、
アトリビュートオブジェクトをまとめて操作する
<strong>node.ChildAttributes</strong>
です。
このオブジェクトはイテレーターであり、
前述のサンプルコードのようにfor文でを使用する事により個別のアトリビュートを参照する事ができます。</p>
</div>
<div class="section" id="sff-makeconnection">
<span id="id6"></span><h4>コネクションを作成する<a class="headerlink" href="#sff-makeconnection" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>アトリビュート同士を接続する場合はアトリビュートオブジェクトを作成し、
アトリビュートオブジェクトどうしを
<strong>「&gt;&gt;」</strong>
を使用してつなぎます。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gris3</span> <span class="kn">import</span> <span class="n">node</span>
<span class="n">trsA</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="s1">&#39;nullA&#39;</span><span class="p">)</span>
<span class="n">trsB</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="s1">&#39;nullB&#39;</span><span class="p">)</span>

<span class="c1"># nullAのtranslateXをnullBのtranslateYへ接続。</span>
<span class="n">trsA</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;tx&#39;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">trsB</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;ty&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>つなぐ場合、片方がアトリビュートオブジェクトであれば、
もう片方は文字列でも問題ありません。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gris3</span> <span class="kn">import</span> <span class="n">node</span>
<span class="n">trsA</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="s1">&#39;nullA&#39;</span><span class="p">)</span>
<span class="n">trsB</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="s1">&#39;nullB&#39;</span><span class="p">)</span>

<span class="c1"># nullAのtranslateXをnullBのtranslateYへ接続。</span>
<span class="n">trsA</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;tx&#39;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">trsB</span><span class="o">+</span><span class="s1">&#39;.ty&#39;</span>

<span class="c1"># nullAのtranslateXをnullBのtranslateZへ接続。</span>
<span class="n">trsA</span><span class="o">+</span><span class="s1">&#39;.tx&#39;</span> <span class="o">&gt;&gt;</span> <span class="n">trsB</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;tz&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>また&gt;&gt;でつなぐ右辺をリストにすると、まとめて接続できます。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gris3</span> <span class="kn">import</span> <span class="n">node</span>
<span class="n">trsA</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="s1">&#39;nullA&#39;</span><span class="p">)</span>
<span class="n">trsB</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="s1">&#39;nullB&#39;</span><span class="p">)</span>

<span class="c1"># nullAのtranslateXをnullBのtranslateYとZへ接続。</span>
<span class="n">trsA</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;tx&#39;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="p">[</span><span class="n">trsB</span><span class="o">+</span><span class="s1">&#39;.ty&#39;</span><span class="p">,</span> <span class="n">trsB</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;tz&#39;</span><span class="p">)]</span>
</pre></div>
</td></tr></table></div>
<p><a href="#id7"><span class="problematic" id="id8">**</span></a>「~」
を使用したChildAttributesオブジェクトもリスト扱いですので、
子アトリビュート全てに接続する事ができます。
またChildAttributesどうしの場合は、子アトリビュートどうしが接続されます。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gris3</span> <span class="kn">import</span> <span class="n">node</span>
<span class="n">trsA</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="s1">&#39;nullA&#39;</span><span class="p">)</span>
<span class="n">trsB</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="s1">&#39;nullB&#39;</span><span class="p">)</span>

<span class="c1"># nullAのtranslateXをnullBのtranslateX、Y、Zへ接続。</span>
<span class="n">trsA</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;tx&#39;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="o">~</span><span class="n">trsB</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>

<span class="c1"># rotateX、Y、Zどうしを接続する。</span>
<span class="o">~</span><span class="n">trsA</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="o">~</span><span class="n">trsB</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="sff-disconnectattr">
<span id="id9"></span><h4>コネクションをを解除する<a class="headerlink" href="#sff-disconnectattr" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>コネクションを解除するにはアトリビュートオブジェクトのdisconnectメソッドを使用します。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gris3</span> <span class="kn">import</span> <span class="n">node</span>
<span class="n">trsA</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="s1">&#39;nullA&#39;</span><span class="p">)</span>
<span class="n">trsB</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="s1">&#39;nullB&#39;</span><span class="p">)</span>

<span class="c1"># nullAのtranslateXをnullBのtranslateX、Y、Zへ接続。</span>
<span class="n">trsA</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;tx&#39;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="o">~</span><span class="n">trsB</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
<span class="n">trsA</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># 接続を解除する。</span>
<span class="n">trsB</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;tx&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>引数にTrueを設定すると元の値を維持した状態で接続を解除できます。
ただしコネクションを解除した段階で元の値が残るかどうかはアトリビュートによるため、
translateのようにデフォルトの挙動が接続解除時に値を残すタイプの場合は影響がありません。</p>
</div>
</div>
<div class="section" id="sff-createnode">
<span id="id10"></span><h3>ノードを作成しオブジェクト化する<a class="headerlink" href="#sff-createnode" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>cmds.createNodeの代わりに使用する事により、
作成されたノードをオブジェクトとして操作できるようになります。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gris3</span> <span class="kn">import</span> <span class="n">node</span>
<span class="n">trs</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="s1">&#39;nullA&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>node.createNodeの引数はcmds.createNodeと同じです。</p>
</div>
<div class="section" id="sff-convselectedtoobj">
<span id="id11"></span><h3>選択ノードをオブジェクト化する<a class="headerlink" href="#sff-convselectedtoobj" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>node.selectedコマンドを使用することのより、
選択ノードをオブジェクトとして操作できるようになります。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">maya</span> <span class="kn">import</span> <span class="n">cmds</span>
<span class="kn">from</span> <span class="nn">gris3</span> <span class="kn">import</span> <span class="n">node</span>
<span class="n">cmds</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;persp&#39;</span><span class="p">,</span> <span class="s1">&#39;side&#39;</span><span class="p">,</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">selected_nodes</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">selected</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>node.selectedの引数にはcmds.lsと同じものが使用できます。</p>
</div>
<div class="section" id="asobjecttoobjects">
<span id="sff-useasobjectandtoobjects"></span><h3>asObject、toObjectsを使用する<a class="headerlink" href="#asobjecttoobjects" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">node</span><span class="o">.</span><span class="n">asObject</span><span class="p">(</span><span class="s1">&#39;オブジェクト名&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>とすると既存のノードをオブジェクト化します。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">maya</span> <span class="kn">import</span> <span class="n">cmds</span>
<span class="kn">from</span> <span class="nn">gris3</span> <span class="kn">import</span> <span class="n">node</span>
<span class="n">trs_name</span> <span class="o">=</span> <span class="n">cmds</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="s1">&#39;normalNode&#39;</span><span class="p">)</span>
<span class="n">trs</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">asObject</span><span class="p">(</span><span class="n">trs_name</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>また、オブジェクト名のリストからも変換する事ができます。
変換するには</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">node</span><span class="o">.</span><span class="n">toObjects</span><span class="p">([</span><span class="s1">&#39;オブジェクトA&#39;</span><span class="p">,</span> <span class="s1">&#39;オブジェクトB&#39;</span><span class="p">,</span> <span class="s1">&#39;オブジェクトC&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
</pre></div>
</div>
<p>を使用します。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">maya</span> <span class="kn">import</span> <span class="n">cmds</span>
<span class="kn">from</span> <span class="nn">gris3</span> <span class="kn">import</span> <span class="n">node</span>
<span class="n">trs_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">trs_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmds</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="s1">&#39;normalNode</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">))</span>
<span class="n">trslist</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">toObjects</span><span class="p">(</span><span class="n">trs_names</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>オブジェクト化する対象が存在しない場合、戻り値はNoneになります。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gris3</span> <span class="kn">import</span> <span class="n">node</span>
<span class="n">node</span><span class="o">.</span><span class="n">asObject</span><span class="p">(</span><span class="s1">&#39;otameshi_name&#39;</span><span class="p">)</span>  <span class="c1">#Noneが返ってくる</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="maya">
<span id="sff-convwrappercommand"></span><h3>mayaの既存コマンドのラッパーから変換する<a class="headerlink" href="#maya" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>cmds.createNode、cmds.lsのように、
mayaの既存コマンドのラッパーコマンドを使用することによりオブジェクト化する事も
可能です。
ラッパーコマンドは基本的に元のコマンドと同じ引数を使用できます。</p>
<table class="docutils align-default" id="id40">
<caption><span class="caption-text">代表的なラッパーコマンド</span><a class="headerlink" href="#id40" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>node.ls</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>node.createNode</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>node.createUtil</p></td>
<td><p>createNodeと同じだが、作成されたノードはchannelBoxのヒストリに表示されない。</p></td>
</tr>
<tr class="row-even"><td><p>node.listRelatives</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>node.listConnections</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>node.sources</p></td>
<td><p>node.listConnections(s=True, d=False)と同義</p></td>
</tr>
<tr class="row-odd"><td><p>node.destinations</p></td>
<td><p>node.listConnections(s=False, d=True)と同義</p></td>
</tr>
<tr class="row-even"><td><p>node.duplicate</p></td>
<td><p>デフォルトの挙動はrrがTrueになるようになっている。rcがTrueの場合のみ、rrの操作が可能になる。</p></td>
</tr>
<tr class="row-odd"><td><p>node.parent</p></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id12">
<h3>オブジェクト化したノードの扱い<a class="headerlink" href="#id12" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>これらのオブジェクト化したノードやアトリビュートは全て
<strong>AbstractNodeStr</strong>
クラスのサブクラスです。</p>
<p>AbstractNodeStrはstrのサブクラスであるため通常の挙動は文字列の操作と同等であり、
文字列として取り扱ったり、
cmdsのコマンドに混ぜても通常の文字列と同じように動作します。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">maya</span> <span class="kn">import</span> <span class="n">cmds</span>
<span class="kn">from</span> <span class="nn">gris3</span> <span class="kn">import</span> <span class="n">node</span>

<span class="n">trs</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="s1">&#39;nullA&#39;</span><span class="p">)</span>
<span class="n">cmds</span><span class="o">.</span><span class="n">getAttr</span><span class="p">(</span><span class="n">trs</span><span class="o">+</span><span class="s1">&#39;.tx&#39;</span><span class="p">)</span>
<span class="c1"># Result: 0.0 #</span>

<span class="n">trs_p</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">trs</span><span class="o">+</span><span class="s1">&#39;Proxy&#39;</span><span class="p">)</span>
<span class="c1"># Result: nullAProxy #</span>
</pre></div>
</td></tr></table></div>
<p>これらオブジェクトには特殊な内部機構を備えており、
Pymel同様紐付いているノードの名前等を変更しても反映されます。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">maya</span> <span class="kn">import</span> <span class="n">cmds</span>
<span class="kn">from</span> <span class="nn">gris3</span> <span class="kn">import</span> <span class="n">node</span>

<span class="n">trs</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="s1">&#39;nullA&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">trs</span><span class="p">)</span>
<span class="c1">#&gt;&gt;&gt; nullA</span>
<span class="n">cmds</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">trs</span><span class="p">,</span> <span class="s1">&#39;groupA&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">trs</span><span class="p">)</span>
<span class="c1">#&gt;&gt;&gt; groupA</span>

<span class="n">trs_p</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">trs</span><span class="o">+</span><span class="s1">&#39;Proxy&#39;</span><span class="p">)</span>
<span class="c1"># Result: groupAProxy #</span>
</pre></div>
</td></tr></table></div>
<p>ただしこれらの挙動はstr内部が持つ文字列が根本的に変わっているわけではなく、
このオブジェクトにアクセスした際に現在のノード名を返すよう上書きされている事に
由来します。
そのため、一部のアクセス方法によっては元の文字列が現れる場合があります。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">maya</span> <span class="kn">import</span> <span class="n">cmds</span>
<span class="kn">from</span> <span class="nn">gris3</span> <span class="kn">import</span> <span class="n">node</span>

<span class="n">trs</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="s1">&#39;nullA&#39;</span><span class="p">)</span>
<span class="n">cmds</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">trs</span><span class="p">,</span> <span class="s1">&#39;groupA&#39;</span><span class="p">)</span>

<span class="n">cmds</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="n">trs</span><span class="p">)</span>
<span class="c1"># Result: [] #</span>
<span class="c1"># ↑これはtrsの元文字列&#39;nullA&#39;がlsに渡されてしまうものの</span>
<span class="c1"># nullAはリネーム済みで存在しないため空のリストになってしまう。</span>
</pre></div>
</td></tr></table></div>
<p>この仕様はPythonの仕様上現在のところ改善が難しく、
上記のような場合はオブジェクトの末尾に()をつけて下さい。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">cmds</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="n">trs</span><span class="p">())</span>
<span class="c1"># Result: [u&#39;groupA&#39;] #</span>
</pre></div>
</td></tr></table></div>
<p>オブジェクトの末尾に()をつけると現在の名前の文字列が返ってくる仕様になっているため、
lsのような文字列部分にアクセスするコマンドに最新の名前が渡されるようになります。</p>
</div>
</div>
<div class="section" id="constructor">
<h2>Constructorクラス<a class="headerlink" href="#constructor" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>このクラスはリグをビルドする際に使用されるクラスです。
grisのファクトリー機能によるビルドは、
誤解を恐れずに言うならばConstructorを実行しているだけに過ぎません。</p>
<p>Constructorはユーザーが任意に作ることができるため、
選択したConstructorによって挙動が変わります。</p>
<p>このセクションではgris標準仕様として備わっているConstructor
「StandardConstructor」についての解説を行います。
また、ここで紹介する機能はConstructorクラスのメソッドになりますので、
各メソッド紹介の頭に付く</p>
<blockquote>
<div><p><strong>self</strong></p>
</div></blockquote>
<p>はConstructorのインスタンスになります。</p>
<div class="section" id="id13">
<h3>コントローラを作る<a class="headerlink" href="#id13" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>StandardConstructorにおけるコントローラ作成の基本の処理は以下のようになります。</p>
<div><svg height="120" viewBox="0 0 920 120" width="920" xmlns="http://www.w3.org/2000/svg" xmlns:inkspace="http://www.inkscape.org/namespaces/inkscape" xmlns:xlink="http://www.w3.org/1999/xlink">
  <defs id="defs_block">
    <filter height="1.504" id="filter_blur" inkspace:collect="always" width="1.1575" x="-0.07875" y="-0.252">
      <feGaussianBlur id="feGaussianBlur3780" inkspace:collect="always" stdDeviation="4.2" />
    </filter>
  </defs>
  <title>blockdiag</title>
  <desc />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="150" x="67" y="46" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="150" x="495" y="46" />
  <polygon fill="rgb(0,0,0)" points="305,46 431,46 407,86 281,86 305,46" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" />
  <polygon fill="rgb(0,0,0)" points="733,46 859,46 835,86 709,86 733,46" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" />
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="150" x="64" y="40" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="90" x="139.0" y="66">joint/transform</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="150" x="492" y="40" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="24" x="567.0" y="66">ctrl</text>
  <polygon fill="rgb(128,160,210)" points="302,40 428,40 404,80 278,80 302,40" stroke="rgb(0,0,0)" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="72" x="353.0" y="66">toController</text>
  <polygon fill="rgb(128,160,210)" points="730,40 856,40 832,80 706,80 730,40" stroke="rgb(0,0,0)" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="102" x="781.0" y="66">connectController</text>
  <path d="M 214 60 L 270 60" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="277,60 270,56 270,64 277,60" stroke="rgb(0,0,0)" />
  <path d="M 642 60 L 698 60" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="705,60 698,56 698,64 705,60" stroke="rgb(0,0,0)" />
  <path d="M 428 60 L 484 60" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="491,60 484,56 484,64 491,60" stroke="rgb(0,0,0)" />
  <path d="M 856 60 L 872 60" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 872 60 L 872 25" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 139 25 L 872 25" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 139 25 L 139 32" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="139,39 135,32 143,32 139,39" stroke="rgb(0,0,0)" />
</svg>
</div>
<p>この工程によって作成されるのはFKコントローラです。
ジョイント階層に任意のジョイントを作成し(この工程の基本は手動)、
それをベースとしてコントローラ階層にFKコントローラを作成し、
そのコントローラからジョイントに接続してコントローラとして機能するようになります。</p>
<div class="section" id="tocontroller">
<h4>toController<a class="headerlink" href="#tocontroller" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>任意のジョイントやトランスフォームに対応するコントローラを作成します。
作成するコントローラは何も影響を及ぼさないただのtransformノードであり、
この段階ではコントローラ自体は何の効力も持ちません。</p>
<p>作成されたコントローラはanimSetに登録されますので、
基本的にコントローラを作成する際にはこのメソッドを使用するようにして下さい。</p>
<p>コントローラの名前は第一引数nameのうち、ノードの種類を表す文字列部分を
<strong>ctrl</strong>
に置き換えたものになります。
そのため引数nameに入れる文字列は命名規則に従ったものにする必要があります。</p>
<div class="admonition seealso">
<p class="admonition-title">参考</p>
<p>名前のルールについては
<a class="reference internal" href="namingRule.html"><span class="doc">命名規則</span></a>
をご確認下さい。</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">toController</span><span class="p">(</span>
    <span class="n">name</span><span class="p">,</span> <span class="n">animSetName</span><span class="p">,</span> <span class="n">animSetPosition</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">nodeType</span><span class="o">=</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="n">function</span>
<span class="p">)</span>
</pre></div>
</div>
<table class="docutils align-default" id="id41">
<caption><span class="caption-text">引数</span><a class="headerlink" href="#id41" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>name</p></td>
<td><p>str</p></td>
<td><p>操作対象ノード名</p></td>
</tr>
<tr class="row-even"><td><p>animSetName</p></td>
<td><p>str</p></td>
<td><p>登録するanimSetの名前</p></td>
</tr>
<tr class="row-odd"><td><p>animSetPosition</p></td>
<td><p>str/int</p></td>
<td><p>animSetの位置を表す文字列</p></td>
</tr>
<tr class="row-even"><td><p>option</p></td>
<td><p>bin</p></td>
<td><p>作成オプション。
後述する
<a class="reference internal" href="#sff-optionsaboutcreationctrl"><span class="std std-ref">作成オプションについて</span></a>
を参照して下さい。</p></td>
</tr>
<tr class="row-odd"><td><p>nodeType</p></td>
<td><p>str</p></td>
<td><p>作成されるノードの種類。基本的にはtransformかそのサブクラス。</p></td>
</tr>
<tr class="row-even"><td><p>filter</p></td>
<td><p>function</p></td>
<td><p>オプションで子ノードも含めてコントローラを作成する際に、
特定のノードを弾くための関数を指定する。</p></td>
</tr>
</tbody>
</table>
<div class="section" id="node-transform">
<h5>戻り値(node.Transform)<a class="headerlink" href="#node-transform" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>戻り値は作成されたコントローラ名オブジェクト(node.Transform)です。</p>
</div>
</div>
<div class="section" id="connectcontroller">
<h4>connectController<a class="headerlink" href="#connectcontroller" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>toControllerで作成したコントローラを任意のジョイントと紐付けを行います。</p>
<p>前述した通りtoControllerで作成されたノードはただのTransformです。</p>
<p>connectControllerを使用するとこのただのTransformを任意の階層まで移動し、
targetとの紐付けを行います。
これによりtargetはtoControllerで作成されたTransformノードによって動かされるようになり、
Transformノードもコントローラとしてアニメーターが選択できるようにシェイプが追加されます。</p>
<table class="docutils align-default" id="id42">
<caption><span class="caption-text">引数</span><a class="headerlink" href="#id42" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>target</p></td>
<td><p>str</p></td>
<td><p>操作対象ノード名。
基本的にtoControllerの第1引数と同じものを入れる。</p></td>
</tr>
<tr class="row-even"><td><p>parent</p></td>
<td><p>str</p></td>
<td><p>コントローラを作成する際の親ノード名。
targetの親と相対的に同じ階層になっていないとtargetの位置がずれるので注意。</p></td>
</tr>
<tr class="row-odd"><td><p>shapeCreator</p></td>
<td><p>func.PrimitiveCreator</p></td>
<td><p>コントローラの形状を定義するオブジェクト</p></td>
</tr>
<tr class="row-even"><td><p>spacers</p></td>
<td><p>list</p></td>
<td><p>コントローラと位置決め用オフセットノードの間に挟むスペーサー用の
Transformノード名の指定を行う。</p></td>
</tr>
<tr class="row-odd"><td><p>calcSpaces</p></td>
<td><p>bool / list</p></td>
<td><p>スペーサーが動いた時に、targetも反応して動くかどうかを指定する。
デフォルトでは反応しない。</p></td>
</tr>
<tr class="row-even"><td><p>option</p></td>
<td><p>bin</p></td>
<td><p>作成オプション。
後述する
<a class="reference internal" href="#sff-optionsaboutcreationctrl"><span class="std std-ref">作成オプションについて</span></a>
を参照して下さい。</p></td>
</tr>
<tr class="row-odd"><td><p>filter</p></td>
<td><p>function</p></td>
<td><p>オプションで子ノードも含めてコントローラを作成する際に、
特定のノードを弾くための関数を指定する。</p></td>
</tr>
</tbody>
</table>
<div class="section" id="list">
<h5>戻り値(list)<a class="headerlink" href="#list" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>戻り値は紐付けされたコントローラ名と、位置決め用オフセット名を持つリストです。
このリストは後述するオプション
<strong>spacers</strong>
によって変動し、
spacesの数だけコントローラ名とオフセットの間のノード名が増えていきます。</p>
<p>戻り値の順番は、コントローラが必ず0番目、オフセットが最後、
その間をつなぐように子階層から１～n番目まで入ります。詳細は下の例文を参考にして下さい。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeCreator</span><span class="p">()</span>
<span class="n">parent</span> <span class="o">=</span> <span class="s1">&#39;localOffset_ctrl&#39;</span>

<span class="c1"># spacesの指定無し</span>
<span class="bp">self</span><span class="o">.</span><span class="n">toController</span><span class="p">(</span><span class="s1">&#39;subarm_jnt_L&#39;</span><span class="p">,</span> <span class="s1">&#39;subarm&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">connectController</span><span class="p">(</span><span class="s1">&#39;subarm_jnt_L&#39;</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">sc</span><span class="p">)</span>
<span class="c1"># Result: [&lt;Transform &#39;subarm_ctrl_L&#39;&gt;, &lt;Joint &#39;subarm_ctrlSpace_L&#39;&gt;]</span>

<span class="c1"># spacesの指定有り(2つ追加)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">toController</span><span class="p">(</span><span class="s1">&#39;subarm_jnt_R&#39;</span><span class="p">,</span> <span class="s1">&#39;subarm&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">connectController</span><span class="p">(</span><span class="s1">&#39;subarm_jnt_R&#39;</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span> <span class="n">spacers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cstPos&#39;</span><span class="p">,</span> <span class="s1">&#39;autoTrs&#39;</span><span class="p">])</span>
<span class="c1"># Result: [&lt;Transform &#39;subarm_ctrl_R&#39;&gt;, &lt;Transform &#39;subarm_autoTrs_R&#39;&gt;, &lt;Transform &#39;subarm_cstPos_R&#39;&gt;, &lt;Joint &#39;subarm_ctrlSpace_R&#39;&gt;]</span>
</pre></div>
</td></tr></table></div>
<p>以下、重要なオプションの解説を行います。</p>
</div>
<div class="section" id="spacers-list">
<h5>spacers(list)<a class="headerlink" href="#spacers-list" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>connectControllerを実行すると、
コントローラに上階層に位置決め用のオフセットノードも一緒に作成されます。
spacersに任意の名前を入れると(復数も可)、
このオフセットとコントローラの間に入れた名前の数だけスペーサー用のヌルを挟むようになります。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>spacers=[]</p></td>
<td><dl class="simple">
<dt>basename_ctrlSpace_C</dt><dd><p><a href="#id14"><span class="problematic" id="id15">|</span></a>_basename_ctrl_C</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td><p>spacers=['costPoint', 'autoTrs']</p></td>
<td><dl class="simple">
<dt>basename_ctrlSpace_C</dt><dd><dl class="simple">
<dt><a href="#id16"><span class="problematic" id="id17">|</span></a>_basename_costPoint_C</dt><dd><dl class="simple">
<dt><a href="#id18"><span class="problematic" id="id19">|</span></a>_basename_autoTrs_C</dt><dd><p><a href="#id20"><span class="problematic" id="id21">|</span></a>_basename_ctrl_C</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="calcspaces-bool-list">
<h5>calcSpaces(bool/list)<a class="headerlink" href="#calcspaces-bool-list" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>このオプションはスペーサーノードを動かした時にターゲットのジョイントも動くかどうかを指定します。
デフォルトはFalseになっており、スペーサーを動かしてもターゲットノードに反応はありません。</p>
<p>このオプションをTrueにするとスペーサーも反応するようになるほか、
list型式でスペーサーの数だけboolを指定すると、
任意のスペーサーだけ反応するようにする事もできます。
listに入れる順番は階層の下から順になります。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeCreator</span><span class="p">()</span>
<span class="n">parent</span> <span class="o">=</span> <span class="s1">&#39;localOffset_ctrl&#39;</span>

<span class="c1"># 全てのスペーサーに反応するようになる。</span>
<span class="bp">self</span><span class="o">.</span><span class="n">toController</span><span class="p">(</span><span class="s1">&#39;subarm_jnt_L&#39;</span><span class="p">,</span> <span class="s1">&#39;subarm&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">connectController</span><span class="p">(</span><span class="s1">&#39;subarm_jnt_L&#39;</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span> <span class="n">calcSpaces</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># &#39;autoTrs&#39;、&#39;cstPos&#39;は反応し、&#39;ctrlSpace&#39;は反応しない。</span>
<span class="bp">self</span><span class="o">.</span><span class="n">connectController</span><span class="p">(</span>
    <span class="s1">&#39;subarm_jnt_R&#39;</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span> <span class="n">spacers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cstPos&#39;</span><span class="p">,</span> <span class="s1">&#39;autoTrs&#39;</span><span class="p">],</span>
    <span class="n">calcSpaces</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="parentascontroller">
<h4>parentAsController<a class="headerlink" href="#parentascontroller" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>任意のノードを指定した階層の子にペアレントします。
その際任意のノードはコントローラシェイプが追加されます。</p>
<p>connectControllerと違いこちらのメソッドはペアレントしつつコントローラシェイプを
追加する以外には何も行いません。
ですのでコントローラから任意のノードへの制御は自前で紐付ける必要があります。</p>
<table class="docutils align-default" id="id43">
<caption><span class="caption-text">引数</span><a class="headerlink" href="#id43" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>controller</p></td>
<td><p>str</p></td>
<td><p>操作対象ノード名。
Transformノードである必要があり、ペアレントされるとtrs値はリセットされる。</p></td>
</tr>
<tr class="row-even"><td><p>parent</p></td>
<td><p>str</p></td>
<td><p>コントローラをペアレントする親ノード名。</p></td>
</tr>
<tr class="row-odd"><td><p>shapeCreator</p></td>
<td><p>func.PrimitiveCreator</p></td>
<td><p>コントローラの形状を定義するオブジェクト</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="sff-optionsaboutcreationctrl">
<span id="id22"></span><h4>作成オプションについて<a class="headerlink" href="#sff-optionsaboutcreationctrl" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>toControllerやconnectControllerには作成オプションを受け取るための引数
<strong>option</strong>
があります。
オプションに渡す値によってそれぞれのメソッドの挙動が変わります。</p>
<p>オプションの効果については以下の通りです。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>ChainCtrl</p></td>
<td><p>この値を指定すると操作対象を任意のノードの子供や孫なども含める。</p></td>
</tr>
<tr class="row-even"><td><p>IgnoreEndCtrl</p></td>
<td><p>この値を指定すると操作対象のうち末端ノードには適用しないようになる。
このオプションはChainCtrlが有効の場合のみ効果を発揮する。</p></td>
</tr>
</tbody>
</table>
<p>これらオプションは
<strong>|</strong>
を使用して複数同時に指定する事も可能です。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">toController</span><span class="p">(</span>
    <span class="s1">&#39;test_jnt_C&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ChainCtrl</span><span class="o">|</span><span class="bp">self</span><span class="o">.</span><span class="n">IgnoreEndCtrl</span>
<span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">connectController</span><span class="p">(</span>
    <span class="s1">&#39;test_jnt_C&#39;</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ChainCtrl</span><span class="o">|</span><span class="bp">self</span><span class="o">.</span><span class="n">IgnoreEndCtrl</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id23">
<h3>各種ルートを作成する<a class="headerlink" href="#id23" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>コントローラやリグを格納するグループを作成するためのメソッドを紹介します。
これから紹介するメソッドは基本的な仕組みはまったく同じで、
作成される場所が変わるようになります。</p>
<blockquote>
<div><ul class="simple">
<li><p>createCtrlRoot</p></li>
<li><p>createRigRoot</p></li>
<li><p>createSetupRoot</p></li>
</ul>
</div></blockquote>
<p>また同じ引数は同じですがデフォルト値が違う場合もありますので、
引数の詳細については各コマンドのリストをご覧下さい。</p>
<p>これらコマンドは、作成するコントローラやリグなどの親を作成する場合に使用します。
最も分かりやすい例で言えば、
ユーザーが任意で作成したジョイントにFKコントローラを作成する場合などが挙げられます。</p>
<a class="reference internal image-reference" href="../_images/0011.png"><img alt="../_images/0011.png" src="../_images/0011.png" style="width: 200px;" /></a>
<p>例えば上手のtarget_jntにFKコントローラをつけたい場合は以下のような記述を行います。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapeCreator</span><span class="p">()</span>
<span class="n">ctrl_root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createCtrlRoot</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="n">parentJoint</span><span class="o">=</span><span class="s1">&#39;parent_jnt_C&#39;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">toController</span><span class="p">(</span><span class="s1">&#39;target_jnt&#39;</span><span class="p">,</span> <span class="s1">&#39;testCtrl&#39;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">connectController</span><span class="p">(</span><span class="s1">&#39;target_jnt&#39;</span><span class="p">,</span> <span class="n">ctrl_root</span><span class="p">,</span> <span class="n">sc</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>するとコントローラ階層であるlocalOffset_ctrlの直下にparent_jnt_Cの代理ノードが作成され、
parent_jnt_Cと相対的に同じ動きをするようになります。
その下にコントローラを作成する事により、
target_ctrlとtarget_jntが相対的に同じ階層になり、
コントローラとジョイントの動きがリンクするようになります。</p>
<a class="reference internal image-reference" href="../_images/002.png"><img alt="../_images/002.png" src="../_images/002.png" style="width: 200px;" /></a>
<div class="section" id="id24">
<h4>ルートの種類<a class="headerlink" href="#id24" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>各コマンドによって作成されるグループはそれぞれ以下の階層の子に配置されます。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>作成に使用するコマンド</strong></p></td>
<td><p><strong>階層名</strong></p></td>
<td><p><strong>概要</strong></p></td>
</tr>
<tr class="row-even"><td><p>createCtrlRoot</p></td>
<td><p>localOffset_ctrl</p></td>
<td><p>コントローラを格納するグループ。</p>
<p>ctrl_grp階層にいるlocalOffset_ctrlの直下に作成される。</p>
</td>
</tr>
<tr class="row-odd"><td><p>createRigRoot</p></td>
<td><p>rig_grp</p></td>
<td><p>ジョイントやコントローラを動かすための仕組みを格納するグループ</p></td>
</tr>
<tr class="row-even"><td><p>createSetupRoot</p></td>
<td><p>setup_grp</p></td>
<td><p>スキニングやデフォーマー等の変形を要する仕組みを格納するグループ</p></td>
</tr>
</tbody>
</table>
<p>各コマンドによって作成されるグループは第一引数に渡した文字列に、
規定の文字列が追加されたものが作成されます。
作成される名前については後述するデフォルト値一覧のnameセクションをご覧下さい。</p>
</div>
<div class="section" id="parentjointisfollow">
<h4>引数parentJointとisFollow<a class="headerlink" href="#parentjointisfollow" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>parentJointはデフォルトではNoneになっており、グループは原点に作成されます。
parentJointに任意のジョイントを指定すると、
作成されるグループはジョイントと同じ位置に作成されます。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>任意のジョイントはjoint_grp下のいずれかである必要があります。</p>
</div>
<p>またisFollowはparentJointで指定したジョイントに追従するかどうかを設定します。
この引数がTrueの場合、作成されたグループはparentJointに拘束されます。</p>
</div>
<div class="section" id="id25">
<h4>デフォルト値一覧<a class="headerlink" href="#id25" title="このヘッドラインへのパーマリンク">¶</a></h4>
<table class="docutils align-default" id="id44">
<caption><span class="caption-text">createCtrlRootのデフォルト値</span><a class="headerlink" href="#id44" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>name</p></td>
<td><p>デフォルト値無し。作成されるグループ名は</p>
<p>name+'Ctrl_parentProxy(_P)'</p>
</td>
</tr>
<tr class="row-even"><td><p>position</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>parentJoint</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>isFollow</p></td>
<td><p>True</p></td>
</tr>
<tr class="row-odd"><td><p>isReuse</p></td>
<td><p>False</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="id45">
<caption><span class="caption-text">createRigRootのデフォルト値</span><a class="headerlink" href="#id45" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>name</p></td>
<td><p>デフォルト値無し。作成されるグループ名は</p>
<p>name+'Rig_grp(_P)'</p>
</td>
</tr>
<tr class="row-even"><td><p>position</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>parentJoint</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>isFollow</p></td>
<td><p>False</p></td>
</tr>
<tr class="row-odd"><td><p>isReuse</p></td>
<td><p>False</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="id46">
<caption><span class="caption-text">createSetupRootのデフォルト値</span><a class="headerlink" href="#id46" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>name</p></td>
<td><p>デフォルト値無し。作成されるグループ名は</p>
<p>name+'Setup_grp(_P)'</p>
</td>
</tr>
<tr class="row-even"><td><p>position</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>parentJoint</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>isFollow</p></td>
<td><p>False</p></td>
</tr>
<tr class="row-odd"><td><p>isReuse</p></td>
<td><p>False</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id26">
<h3>重要ノードを取得する<a class="headerlink" href="#id26" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>リグの構造内に存在する重要ノードにアクセスするためのメソッドを紹介します。
名前決め打ちで取得するよりも、こちらのメソッドを介して取得することをオススメしています。</p>
<table class="docutils align-default" id="id47">
<caption><span class="caption-text">重要ノード取得メソッド(Constructorクラスのメソッド)</span><a class="headerlink" href="#id47" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>root()</p></td>
<td><p>grisNode.GrisRoot</p></td>
<td><p>ルートノードを取得する</p></td>
</tr>
<tr class="row-even"><td><p>ctrlGroup()</p></td>
<td><p>grisNode.CtrlGroup</p></td>
<td><p>コントローラを保持するトップノードを返す。</p></td>
</tr>
<tr class="row-odd"><td><p>ctrlTop()</p></td>
<td><p>node.Transform</p></td>
<td><p>コントローラのトップ(全てのコントローラのトップ)を返す。</p></td>
</tr>
<tr class="row-even"><td><p>ctrlGroup().displayCtrl()</p></td>
<td><p>node.Transform</p></td>
<td><p>表示制御用のコントローラを返す。</p></td>
</tr>
<tr class="row-odd"><td><p>root().baseJointGroup().worldTransform()</p></td>
<td><p>node.Transform</p></td>
<td><p>ジョイント階層のトップノードを返す。</p></td>
</tr>
<tr class="row-even"><td><p>rigGroup()</p></td>
<td><p>node.Transform</p></td>
<td><p>リグのグループトップを返す。</p></td>
</tr>
<tr class="row-odd"><td><p>setupGroup()</p></td>
<td><p>grisNode.SetupGroup</p></td>
<td><p>セットアップ用データを格納するグループを返す。</p></td>
</tr>
<tr class="row-even"><td><p>modelGroup()</p></td>
<td><p>node.Transform</p></td>
<td><p>レンダリングジオメトリを格納したグループノードを返す。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="func">
<h2>funcモジュール<a class="headerlink" href="#func" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>このモジュールはリギングする上で便利な関数などを提供します。
このセクションでは代表的な便利関数の紹介を行います。</p>
<div class="section" id="id27">
<h3>階層構造に関する関数<a class="headerlink" href="#id27" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="listnodechain">
<h4>listNodeChain<a class="headerlink" href="#listnodechain" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>任意の2つのトランスフォームノードが親子の時、
その2つの階層間のノードを全てリストします。
第2引数で指定するトランスフォームノードは第1引数の子である必要があります。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gris3</span> <span class="kn">import</span> <span class="n">node</span><span class="p">,</span> <span class="n">func</span>
<span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">joints</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s1">&#39;joint&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">parent</span><span class="p">)</span>
    <span class="n">joints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
    <span class="n">parent</span><span class="p">(</span><span class="s1">&#39;tx&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">func</span><span class="o">.</span><span class="n">listNodeChain</span><span class="p">(</span><span class="n">joints</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">joints</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
<span class="c1"># Result: [&lt;Joint &#39;joint2&#39;&gt;, &lt;Joint &#39;joint3&#39;&gt;, &lt;Joint &#39;joint4&#39;&gt;, &lt;Joint &#39;joint5&#39;&gt;, &lt;Joint &#39;joint6&#39;&gt;] #</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="listlength">
<h4>listLength<a class="headerlink" href="#listlength" title="このヘッドラインへのパーマリンク">¶</a></h4>
</div>
<div class="section" id="listlengthratio">
<h4>listLengthRatio<a class="headerlink" href="#listlengthratio" title="このヘッドラインへのパーマリンク">¶</a></h4>
</div>
<div class="section" id="listsinglechain">
<h4>listSingleChain<a class="headerlink" href="#listsinglechain" title="このヘッドラインへのパーマリンク">¶</a></h4>
</div>
</div>
<div class="section" id="id28">
<h3>アトリビュートの状態を操作する関数<a class="headerlink" href="#id28" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="locktransform">
<h4>lockTransform<a class="headerlink" href="#locktransform" title="このヘッドラインへのパーマリンク">¶</a></h4>
</div>
<div class="section" id="unlocktransform">
<h4>unlockTransform<a class="headerlink" href="#unlocktransform" title="このヘッドラインへのパーマリンク">¶</a></h4>
</div>
<div class="section" id="controlchannels">
<h4>controlChannels<a class="headerlink" href="#controlchannels" title="このヘッドラインへのパーマリンク">¶</a></h4>
</div>
</div>
<div class="section" id="id29">
<h3>アトリビュートのコネクションを操作する関数<a class="headerlink" href="#id29" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="fconnectattr">
<h4>fConnectAttr<a class="headerlink" href="#fconnectattr" title="このヘッドラインへのパーマリンク">¶</a></h4>
</div>
<div class="section" id="transferconnection">
<h4>transferConnection<a class="headerlink" href="#transferconnection" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>srcNodeAttrに接続しているアトリビュートをdstNodeAttrへ接続しなおします。
keepConnectionがFalseの場合、srcNodeAttrへの接続は解除します。</p>
<p>replaceConnectionsに似ていますが、こちらはアトリビュート単位で接続しなおします。</p>
</div>
<div class="section" id="replaceconnections">
<h4>replaceConnections<a class="headerlink" href="#replaceconnections" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>srcNodeのコネクションをdstNodeにつなぎ直し、srcNodeのコネクションは開放します。
srcNodeに接続されているアトリビュート名と同じ名前のアトリビュートをdstNodeから探し接続するため、
srcNodeとdstNodeは互換性のあるノードが望ましいです。</p>
</div>
<div class="section" id="setattrfromconnected">
<h4>setAttrFromConnected<a class="headerlink" href="#setattrfromconnected" title="このヘッドラインへのパーマリンク">¶</a></h4>
</div>
<div class="section" id="connectkeyableattr">
<h4>connectKeyableAttr<a class="headerlink" href="#connectkeyableattr" title="このヘッドラインへのパーマリンク">¶</a></h4>
</div>
<div class="section" id="connectmultattr">
<h4>connectMultAttr<a class="headerlink" href="#connectmultattr" title="このヘッドラインへのパーマリンク">¶</a></h4>
</div>
<div class="section" id="makedecomposematrixconnection">
<h4>makeDecomposeMatrixConnection<a class="headerlink" href="#makedecomposematrixconnection" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>decomposeMatrixノードをtargetsに接続します。
targetsはtransformノードのリストである必要があります。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gris3</span> <span class="kn">import</span> <span class="n">func</span><span class="p">,</span> <span class="n">node</span>
<span class="n">decmtx</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">createUtil</span><span class="p">(</span><span class="s1">&#39;decomposeMatrix&#39;</span><span class="p">)</span>
<span class="n">trs</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">)</span>
<span class="n">func</span><span class="o">.</span><span class="n">makeDecomposeMatrixConnection</span><span class="p">(</span><span class="n">decmtx</span><span class="p">,</span> <span class="p">[</span><span class="n">trs</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="transform">
<h3>Transformの位置をブレンドする<a class="headerlink" href="#transform" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="blendselfconnection">
<h4>blendSelfConnection<a class="headerlink" href="#blendselfconnection" title="このヘッドラインへのパーマリンク">¶</a></h4>
</div>
<div class="section" id="blendtransform">
<h4>blendTransform<a class="headerlink" href="#blendtransform" title="このヘッドラインへのパーマリンク">¶</a></h4>
</div>
</div>
<div class="section" id="id30">
<h3>Transformを拘束する<a class="headerlink" href="#id30" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="surfacefitter">
<h4>SurfaceFitter<a class="headerlink" href="#surfacefitter" title="このヘッドラインへのパーマリンク">¶</a></h4>
</div>
<div class="section" id="localconstraint">
<h4>localConstraint<a class="headerlink" href="#localconstraint" title="このヘッドラインへのパーマリンク">¶</a></h4>
</div>
<div class="section" id="fixconstraint">
<h4>fixConstraint<a class="headerlink" href="#fixconstraint" title="このヘッドラインへのパーマリンク">¶</a></h4>
</div>
</div>
<div class="section" id="id31">
<h3>デフォーマーを追加する<a class="headerlink" href="#id31" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="wrap">
<h4>wrap<a class="headerlink" href="#wrap" title="このヘッドラインへのパーマリンク">¶</a></h4>
</div>
<div class="section" id="localwrap">
<h4>localWrap<a class="headerlink" href="#localwrap" title="このヘッドラインへのパーマリンク">¶</a></h4>
</div>
<div class="section" id="createsculptdeformer">
<h4>createSculptDeformer<a class="headerlink" href="#createsculptdeformer" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>この関数はメッシュにsculptDeformerを適用し、
それを制御するためのTransformノードもセットで作成します。</p>
<p>下記サンプルコードではポリゴン球を作成し、その球にscrulptDeformerを適用しています。</p>
<p><a class="reference internal" href="#sff-funcsoftmodification"><span class="std std-ref">SoftModification</span></a>
のようなコントローラなどがセットになっている機構を提供するわけではありません。</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gris3</span> <span class="kn">import</span> <span class="n">func</span>
<span class="kn">from</span> <span class="nn">maya</span> <span class="kn">import</span> <span class="n">cmds</span>
<span class="c1"># 操作対象となるノードを作成。</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">cmds</span><span class="o">.</span><span class="n">polySphere</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sx</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">sy</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">cuv</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># デフォーマーとコントローラを作成。</span>
<span class="n">sd</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">createSculptDeformer</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s1">&#39;pushed&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">)</span>
<span class="n">sd</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
<span class="n">sd</span><span class="p">[</span><span class="mi">2</span><span class="p">](</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
<a class="reference internal image-reference" href="../_images/sculptDef001.png"><img alt="../_images/sculptDef001.png" src="../_images/sculptDef001.png" style="width: 300px;" /></a>
</div>
<div class="section" id="softmodification">
<span id="sff-funcsoftmodification"></span><h4>SoftModification<a class="headerlink" href="#softmodification" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>このクラスはメッシュにsoftModificationデフォーマーと、
それを制御するためのコントローラを作成するための機能を提供します。</p>
<a class="reference internal image-reference" href="../_images/softMod001.png"><img alt="../_images/softMod001.png" src="../_images/softMod001.png" style="width: 300px;" /></a>
<div class="section" id="id32">
<h5>作成する<a class="headerlink" href="#id32" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>使用するにはクラスをインスタンスし、操作対象となるメッシュに対して
<strong>createWithControllerSystem</strong>
メソッドを使用します。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gris3</span> <span class="kn">import</span> <span class="n">func</span>
<span class="kn">from</span> <span class="nn">maya</span> <span class="kn">import</span> <span class="n">cmds</span>
<span class="c1"># 操作対象となるノードを作成。</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">cmds</span><span class="o">.</span><span class="n">polySphere</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sx</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">sy</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">cuv</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># デフォーマーとコントローラを作成。</span>
<span class="n">smod</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">SoftModification</span><span class="p">()</span>
<span class="n">smod</span><span class="o">.</span><span class="n">createWithControllerSystem</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
<span class="c1"># Result: {&#39;controllers&#39;: [&lt;Transform &#39;softMod_ctrl&#39;&gt;, &lt;Transform &#39;softModRadius_ctrl&#39;&gt;, &lt;Transform &#39;softMod_ctrlSpace&#39;&gt;], &#39;proxies&#39;: [u&#39;softMod_ctrlProxy&#39;, &lt;Transform &#39;softModRadius_ctrlProxy&#39;&gt;, &lt;Transform &#39;softMod_ctrlSpaceProxy&#39;&gt;]} #</span>
</pre></div>
</td></tr></table></div>
<p>コマンドを実行するとsoftModのデフォーマーを対象ノードに作成し、
それを制御するためのコントローラと代理ノードが作成され、
<strong>createWithControllerSystem</strong>
の戻り値として返ってきます。</p>
<a class="reference internal image-reference" href="../_images/softMod002.png"><img alt="../_images/softMod002.png" src="../_images/softMod002.png" style="width: 200px;" /></a>
</div>
<div class="section" id="id33">
<h5>コントローラの位置を編集する<a class="headerlink" href="#id33" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>コントローラとその代理ノードは対になっています。
ctrlSpaceProxyとctrlSpaceを同じ位置に移動する事により、コントローラの初期位置を
変更する事ができます。</p>
<a class="reference internal image-reference" href="../_images/softMod004.png"><img alt="../_images/softMod004.png" src="../_images/softMod004.png" style="width: 300px;" /></a>
<p>また、作成する際に
<strong>setRadiusScale</strong>
を使用すると、デフォルトの影響範囲を変更する事ができます。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gris3</span> <span class="kn">import</span> <span class="n">func</span>
<span class="kn">from</span> <span class="nn">maya</span> <span class="kn">import</span> <span class="n">cmds</span>
<span class="c1"># 操作対象となるノードを作成。</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">cmds</span><span class="o">.</span><span class="n">polySphere</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sx</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">sy</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">cuv</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># デフォーマーとコントローラを作成。</span>
<span class="n">smod</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">SoftModification</span><span class="p">()</span>
<span class="n">smod</span><span class="o">.</span><span class="n">setRadiusScale</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">smod</span><span class="o">.</span><span class="n">createWithControllerSystem</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<a class="reference internal image-reference" href="../_images/softMod003.png"><img alt="../_images/softMod003.png" src="../_images/softMod003.png" style="width: 300px;" /></a>
<p>このようにsoftModRadius_ctrlのradiusは１のままですが、
半径が0.5に小さくなっているのがわかります。</p>
</div>
<div class="section" id="id34">
<h5>作成時の名前を操作する<a class="headerlink" href="#id34" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>デフォルトのままでは特定の名前になってしまいますが、
以下のメソッドを使用すると任意の名前に変更する事ができます。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>メソッド名</strong></p></td>
<td><p><strong>型</strong></p></td>
<td><p><strong>説明</strong></p></td>
</tr>
<tr class="row-even"><td><p>setBaseName</p></td>
<td><p>str</p></td>
<td><p>コントローラのベースとなる名前を設定する</p></td>
</tr>
<tr class="row-odd"><td><p>setPosition</p></td>
<td><p>str</p></td>
<td><p>コントローラの位置を表す文字列を指定する</p></td>
</tr>
</tbody>
</table>
<p>下記のコードではポリゴン球を作成し、
左右にデフォルト半径が異なるコントローラを2つ作成しています。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gris3</span> <span class="kn">import</span> <span class="n">func</span>
<span class="kn">from</span> <span class="nn">maya</span> <span class="kn">import</span> <span class="n">cmds</span>
<span class="c1"># 操作対象となるノードを作成。</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">cmds</span><span class="o">.</span><span class="n">polySphere</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sx</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">sy</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">cuv</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># デフォーマーとコントローラを作成。</span>
<span class="n">smod</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">SoftModification</span><span class="p">()</span>
<span class="n">smod</span><span class="o">.</span><span class="n">setBaseName</span><span class="p">(</span><span class="s1">&#39;sphere&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">p_label</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">radius</span> <span class="ow">in</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mf">1.2</span><span class="p">)</span>
<span class="p">]:</span>
    <span class="n">smod</span><span class="o">.</span><span class="n">setPosition</span><span class="p">(</span><span class="n">p_label</span><span class="p">)</span>
    <span class="n">smod</span><span class="o">.</span><span class="n">setRadiusScale</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>
    <span class="n">ctrls</span> <span class="o">=</span> <span class="n">smod</span><span class="o">.</span><span class="n">createWithControllerSystem</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="c1"># コントローラと代理ノードの位置を調整</span>
    <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;controllers&#39;</span><span class="p">,</span> <span class="s1">&#39;proxies&#39;</span><span class="p">):</span>
        <span class="n">ctrls</span><span class="p">[</span><span class="n">part</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">](</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<a class="reference internal image-reference" href="../_images/softMod005.png"><img alt="../_images/softMod005.png" src="../_images/softMod005.png" style="width: 300px;" /></a>
</div>
</div>
</div>
<div class="section" id="id35">
<h3>長さや角度を検知する<a class="headerlink" href="#id35" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="createdistancedrivernode">
<h4>createDistanceDriverNode<a class="headerlink" href="#createdistancedrivernode" title="このヘッドラインへのパーマリンク">¶</a></h4>
</div>
<div class="section" id="id36">
<h4>createSculptDeformer<a class="headerlink" href="#id36" title="このヘッドラインへのパーマリンク">¶</a></h4>
</div>
</div>
<div class="section" id="id37">
<h3>ジョイントチェーンのツイスト、ベンド制御を行う<a class="headerlink" href="#id37" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="createnontwistedbender">
<h4>createNonTwistedBender<a class="headerlink" href="#createnontwistedbender" title="このヘッドラインへのパーマリンク">¶</a></h4>
</div>
<div class="section" id="createbendcontrol">
<h4>createBendControl<a class="headerlink" href="#createbendcontrol" title="このヘッドラインへのパーマリンク">¶</a></h4>
</div>
<div class="section" id="createbendtwistcontrol">
<h4>createBendTwistControl<a class="headerlink" href="#createbendtwistcontrol" title="このヘッドラインへのパーマリンク">¶</a></h4>
</div>
</div>
<div class="section" id="id38">
<h3>バインドジョイントに関する関数<a class="headerlink" href="#id38" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="createbindjoint">
<h4>createBindJoint<a class="headerlink" href="#createbindjoint" title="このヘッドラインへのパーマリンク">¶</a></h4>
</div>
<div class="section" id="findbindjoint">
<h4>findBindJoint<a class="headerlink" href="#findbindjoint" title="このヘッドラインへのパーマリンク">¶</a></h4>
</div>
<div class="section" id="connecttobindjoint">
<h4>connectToBindJoint<a class="headerlink" href="#connecttobindjoint" title="このヘッドラインへのパーマリンク">¶</a></h4>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="namingRule.html" class="btn btn-neutral float-right" title="命名規則" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="scriptBasedRigging.html" class="btn btn-neutral float-left" title="ScriptBasedRigging-概要" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; 著作権 2020, EskeYoshinob

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>